
d:\- - - - - x.Egressy 2023\- 3. Félév\- - - Tiszta Város\TisztaVaros_BackEnd__Github\backend\routes>npm test

> backend@1.0.0 test
> jest --detectOpenHandles

  console.log
    Executing (default): SELECT `id`, `username`, `password`, `email`, `zipCode`, `city`, `address`, `points`, `role`, `isActive`, `institutionId`, `avatarStyle`, `avatarSeed`, `avatarChangesToday`, `lastAvatarChangeDate`, `activationToken`, `activationExpires`, `createdAt`, `updatedAt` FROM `users` AS `user` WHERE `user`.`email` = 'admin@admin.hu';

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    Logged Admin:  {
      id: 'c18f964e-9ea0-41ed-b859-96979320b9e2',
      role: 'admin',
      institutionId: null,
      iat: 1756799721,
      exp: 1772351721
    }

      at Object.log (routes/usersRoutes_Ori.test.js:35:17)

  console.log
    Executing (default): SELECT `id`, `username`, `email`, `points`, `role`, `isActive`, `createdAt`, `updatedAt` FROM `users` AS `user` WHERE `user`.`email` LIKE '%pepe2@smd.hu%';

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    {
      id: '7046495d-4c2c-487c-a153-4ab4dd1c42de',
      username: 'Meki Admin',
      email: 'pepe2@smd.hu',
      points: 0,
      role: 'institution',
      isActive: 'active',
      createdAt: '2025-08-28T21:27:32.000Z',
      updatedAt: '2025-09-02T06:24:51.000Z'
    }

      at Object.log (routes/usersRoutes_Ori.test.js:46:17)

  console.log
    Executing (default): SELECT `id`, `username`, `password`, `email`, `zipCode`, `city`, `address`, `points`, `role`, `isActive`, `institutionId`, `avatarStyle`, `avatarSeed`, `avatarChangesToday`, `lastAvatarChangeDate`, `activationToken`, `activationExpires`, `createdAt`, `updatedAt` FROM `users` AS `user` WHERE `user`.`id` = '7046495d-4c2c-487c-a153-4ab4dd1c42de';

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    Executing (default): SELECT `id`, `username`, `password`, `email`, `zipCode`, `city`, `address`, `points`, `role`, `isActive`, `institutionId`, `avatarStyle`, `avatarSeed`, `avatarChangesToday`, `lastAvatarChangeDate`, `activationToken`, `activationExpires`, `createdAt`, `updatedAt` FROM `users` AS `user` WHERE `user`.`email` = 'pepe2@smd.hu';

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    Logged user:  {
      id: '7046495d-4c2c-487c-a153-4ab4dd1c42de',
      role: 'institution',
      institutionId: '0841b0fc-7c6d-11f0-9b55-2cf05dad8c1f',
      iat: 1756799721,
      exp: 1772351721
    }

      at Object.log (routes/usersRoutes_Ori.test.js:65:17)

  console.log
    Executing (default): SELECT `id`, `username`, `password`, `email`, `zipCode`, `city`, `address`, `points`, `role`, `isActive`, `institutionId`, `avatarStyle`, `avatarSeed`, `avatarChangesToday`, `lastAvatarChangeDate`, `activationToken`, `activationExpires`, `createdAt`, `updatedAt` FROM `users` AS `user` WHERE `user`.`email` = 'zoardakarki@gmail.com';

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    Logged Worker:  {
      id: '0855dcd3-cf33-4d75-9ce9-1248fb2979a0',
      role: 'worker',
      institutionId: '0841b0fc-7c6d-11f0-9b55-2cf05dad8c1f',
      iat: 1756799722,
      exp: 1772351722
    }

      at Object.log (routes/usersRoutes_Ori.test.js:75:17)

  console.log
    { message: 'Nincs jogosultság!' }

      at Object.log (routes/usersRoutes_Ori.test.js:84:17)

  console.log
    Executing (default): SELECT `id`, `username`, `email`, `isActive`, `role`, `institutionId`, `points`, `createdAt`, `updatedAt` FROM `users` AS `user`;

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    User All:  6 [
      {
        id: '0855dcd3-cf33-4d75-9ce9-1248fb2979a0',
        username: 'Akárki Zoárd',
        email: 'zoardakarki@gmail.com',
        isActive: 'active',
        role: 'worker',
        institutionId: '0841b0fc-7c6d-11f0-9b55-2cf05dad8c1f',
        points: 0,
        createdAt: '2025-08-20T18:50:56.000Z',
        updatedAt: '2025-08-20T18:50:56.000Z'
      },
      {
        id: '379f8a2e-c223-4e2b-8008-ec5144474007',
        username: 'Teszt Elek',
        email: 'tesztelget2000@gmail.com',
        isActive: 'active',
        role: 'user',
        institutionId: null,
        points: 0,
        createdAt: '2025-08-22T19:37:48.000Z',
        updatedAt: '2025-08-22T19:37:48.000Z'
      },
      {
        id: '3c4debe2-e405-4cd7-8147-f27d6dee660a',
        username: 'Meki Lekk',
        email: 'pepe@smd.hu',
        isActive: 'active',
        role: 'user',
        institutionId: null,
        points: 0,
        createdAt: '2025-08-28T21:27:32.000Z',
        updatedAt: '2025-08-28T21:27:32.000Z'
      },
      {
        id: '7046495d-4c2c-487c-a153-4ab4dd1c42de',
        username: 'Meki Admin',
        email: 'pepe2@smd.hu',
        isActive: 'active',
        role: 'institution',
        institutionId: '0841b0fc-7c6d-11f0-9b55-2cf05dad8c1f',
        points: 0,
        createdAt: '2025-08-28T21:27:32.000Z',
        updatedAt: '2025-09-02T06:24:51.000Z'
      },
      {
        id: 'c18f964e-9ea0-41ed-b859-96979320b9e2',
        username: 'Admin Józsi',
        email: 'admin@admin.hu',
        isActive: 'active',
        role: 'admin',
        institutionId: null,
        points: 0,
        createdAt: '2025-08-20T18:51:52.000Z',
        updatedAt: '2025-08-20T18:51:52.000Z'
      },
      {
        id: 'ffcb5a6a-57d9-4518-bd49-7ac276df3f01',
        username: 'Mekk Elek',
        email: 'mindent_is_tudok@gmail.com',
        isActive: 'inactive',
        role: 'user',
        institutionId: null,
        points: 0,
        createdAt: '2025-09-01T13:52:06.000Z',
        updatedAt: '2025-09-01T13:52:06.000Z'
      }
    ]

      at Object.log (routes/usersRoutes_Ori.test.js:91:17)

  console.log
    Sel. User:  {
      id: '7046495d-4c2c-487c-a153-4ab4dd1c42de',
      username: 'Meki Admin',
      email: 'pepe2@smd.hu',
      isActive: 'active',
      role: 'institution',
      institutionId: '0841b0fc-7c6d-11f0-9b55-2cf05dad8c1f',
      points: 0,
      createdAt: '2025-08-28T21:27:32.000Z',
      updatedAt: '2025-09-02T06:24:51.000Z'
    }

      at Object.log (routes/usersRoutes_Ori.test.js:95:17)

  console.log
    Executing (default): SELECT `id`, `username`, `password`, `email`, `zipCode`, `city`, `address`, `points`, `role`, `isActive`, `institutionId`, `avatarStyle`, `avatarSeed`, `avatarChangesToday`, `lastAvatarChangeDate`, `activationToken`, `activationExpires`, `createdAt`, `updatedAt` FROM `users` AS `user` WHERE `user`.`id` = '7046495d-4c2c-487c-a153-4ab4dd1c42de';

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    Executing (default): UPDATE `users` SET `role`=?,`updatedAt`=? WHERE `id` = ?

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    Meki Admin : user

      at Object.log (routes/usersRoutes_Ori.test.js:105:17)

  console.log
    Meki Admin : worker

      at Object.log (routes/usersRoutes_Ori.test.js:113:17)

  console.log
    Meki Admin : worker

      at Object.log (routes/usersRoutes_Ori.test.js:121:17)

  console.log
    Executing (default): SELECT `institution`.`id`, `institution`.`name`, `institution`.`email`, `institution`.`description`, `institution`.`contactInfo`, `institution`.`logoUrl`, `institution`.`createdAt`, `institution`.`updatedAt`, `users`.`id` AS `users.id`, `users`.`username` AS `users.username`, `users`.`email` AS `users.email` FROM `institutions` AS `institution` LEFT OUTER JOIN `users` AS `users` ON `institution`.`id` = `users`.`institutionId`;

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    Sel. Inst:  {
      id: '0841b0fc-7c6d-11f0-9b55-2cf05dad8c1f',
      name: 'BKK Zrt. - Admin Modified - Worker Modified - Admin Modified - Worker Modified - Admin Modified - Worker Modified - Admin Modified - Worker Modified - Admin Modified - Worker Modified - Admin Modified - Worker Modified - Admin Modified - Worker Modified -',
      email: 'ugyfelszolgalat@bkk.hu',
      description: 'Közösségi közlekedésért felelős szervezet Budapesten.',
      contactInfo: 'Cím: 1075 Budapest, Rumbach Sebestyén u. 19-21. | Tel: +36 1 325 5255',
      logoUrl: null,
      createdAt: '2025-08-18T21:53:04.000Z',
      updatedAt: '2025-09-02T07:53:44.000Z',
      users: [
        {
          id: '0855dcd3-cf33-4d75-9ce9-1248fb2979a0',
          username: 'Akárki Zoárd',
          email: 'zoardakarki@gmail.com'
        },
        {
          id: '7046495d-4c2c-487c-a153-4ab4dd1c42de',
          username: 'Meki Admin',
          email: 'pepe2@smd.hu'
        }
      ]
    }

      at Object.log (routes/usersRoutes_Ori.test.js:132:17)

  console.log
    Mod. Sel. Inst:  {
      id: '0841b0fc-7c6d-11f0-9b55-2cf05dad8c1f',
      name: 'BKK Zrt. - Admin Modified - Worker Modified - Admin Modified - Worker Modified - Admin Modified - Worker Modified - Admin Modified - Worker Modified - Admin Modified - Worker Modified - Admin Modified - Worker Modified - Admin Modified - Worker Modified -',
      email: 'ugyfelszolgalat@bkk.hu',
      description: 'Közösségi közlekedésért felelős szervezet Budapesten.',
      contactInfo: 'Cím: 1075 Budapest, Rumbach Sebestyén u. 19-21. | Tel: +36 1 325 5255',
      logoUrl: null,
      createdAt: '2025-08-18T21:53:04.000Z',
      updatedAt: '2025-09-02T07:53:44.000Z',
      users: [
        {
          id: '0855dcd3-cf33-4d75-9ce9-1248fb2979a0',
          username: 'Akárki Zoárd',
          email: 'zoardakarki@gmail.com'
        },
        {
          id: '7046495d-4c2c-487c-a153-4ab4dd1c42de',
          username: 'Meki Admin',
          email: 'pepe2@smd.hu'
        }
      ]
    }

      at Object.log (routes/usersRoutes_Ori.test.js:138:17)

  console.log
    Mod. Sel. Inst.ID:  0841b0fc-7c6d-11f0-9b55-2cf05dad8c1f

      at Object.log (routes/usersRoutes_Ori.test.js:139:17)

  console.log
    Executing (default): SELECT `id`, `username`, `password`, `email`, `zipCode`, `city`, `address`, `points`, `role`, `isActive`, `institutionId`, `avatarStyle`, `avatarSeed`, `avatarChangesToday`, `lastAvatarChangeDate`, `activationToken`, `activationExpires`, `createdAt`, `updatedAt` FROM `users` AS `user` WHERE `user`.`id` = '7046495d-4c2c-487c-a153-4ab4dd1c42de';

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    Executing (default): SELECT `id`, `name`, `email`, `description`, `contactInfo`, `logoUrl`, `createdAt`, `updatedAt` FROM `institutions` AS `institution` WHERE `institution`.`id` = '0841b0fc-7c6d-11f0-9b55-2cf05dad8c1f';

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    Executing (default): SELECT `id`, `username`, `password`, `email`, `zipCode`, `city`, `address`, `points`, `role`, `isActive`, `institutionId`, `avatarStyle`, `avatarSeed`, `avatarChangesToday`, `lastAvatarChangeDate`, `activationToken`, `activationExpires`, `createdAt`, `updatedAt` FROM `users` AS `user` WHERE `user`.`id` = '123456789';

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    Executing (default): SELECT `id`, `username`, `password`, `email`, `zipCode`, `city`, `address`, `points`, `role`, `isActive`, `institutionId`, `avatarStyle`, `avatarSeed`, `avatarChangesToday`, `lastAvatarChangeDate`, `activationToken`, `activationExpires`, `createdAt`, `updatedAt` FROM `users` AS `user` WHERE `user`.`id` = '7046495d-4c2c-487c-a153-4ab4dd1c42de';

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    Executing (default): SELECT `id`, `name`, `email`, `description`, `contactInfo`, `logoUrl`, `createdAt`, `updatedAt` FROM `institutions` AS `institution` WHERE `institution`.`id` = '0123456789';

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    Executing (default): SELECT `id`, `username`, `password`, `email`, `zipCode`, `city`, `address`, `points`, `role`, `isActive`, `institutionId`, `avatarStyle`, `avatarSeed`, `avatarChangesToday`, `lastAvatarChangeDate`, `activationToken`, `activationExpires`, `createdAt`, `updatedAt` FROM `users` AS `user` WHERE `user`.`id` = '7046495d-4c2c-487c-a153-4ab4dd1c42de';

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    Executing (default): UPDATE `users` SET `zipCode`=?,`updatedAt`=? WHERE `id` = ?

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    Executing (default): SELECT `id`, `username`, `password`, `email`, `zipCode`, `city`, `address`, `points`, `role`, `isActive`, `institutionId`, `avatarStyle`, `avatarSeed`, `avatarChangesToday`, `lastAvatarChangeDate`, `activationToken`, `activationExpires`, `createdAt`, `updatedAt` FROM `users` AS `user` WHERE `user`.`id` = '7046495d-4c2c-487c-a153-4ab4dd1c42de';

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    Executing (default): UPDATE `users` SET `isActive`=?,`updatedAt`=? WHERE `id` = ?

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    Executing (default): SELECT `id`, `username`, `password`, `email`, `zipCode`, `city`, `address`, `points`, `role`, `isActive`, `institutionId`, `avatarStyle`, `avatarSeed`, `avatarChangesToday`, `lastAvatarChangeDate`, `activationToken`, `activationExpires`, `createdAt`, `updatedAt` FROM `users` AS `user` WHERE `user`.`email` = 'pepe2@smd.hu';

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    Executing (default): SELECT `id`, `username`, `password`, `email`, `zipCode`, `city`, `address`, `points`, `role`, `isActive`, `institutionId`, `avatarStyle`, `avatarSeed`, `avatarChangesToday`, `lastAvatarChangeDate`, `activationToken`, `activationExpires`, `createdAt`, `updatedAt` FROM `users` AS `user` WHERE `user`.`email` = 'pepe2@smd.hu';

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    Executing (default): SELECT `id`, `username`, `email`, `points`, `role`, `isActive`, `createdAt`, `updatedAt` FROM `users` AS `user` WHERE `user`.`username` LIKE '%Mek%' AND `user`.`email` LIKE '%smd.hu%';

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    User List:  [
      {
        id: '3c4debe2-e405-4cd7-8147-f27d6dee660a',
        username: 'Meki Lekk',
        email: 'pepe@smd.hu',
        points: 0,
        role: 'user',
        isActive: 'active',
        createdAt: '2025-08-28T21:27:32.000Z',
        updatedAt: '2025-08-28T21:27:32.000Z'
      },
      {
        id: '7046495d-4c2c-487c-a153-4ab4dd1c42de',
        username: 'Meki Admin',
        email: 'pepe2@smd.hu',
        points: 0,
        role: 'user',
        isActive: 'inactive',
        createdAt: '2025-08-28T21:27:32.000Z',
        updatedAt: '2025-09-02T07:55:22.000Z'
      }
    ]

      at Object.log (routes/usersRoutes_Ori.test.js:204:17)

  console.log
    Executing (default): SELECT `id`, `username`, `email`, `points`, `role`, `isActive`, `createdAt`, `updatedAt` FROM `users` AS `user` WHERE `user`.`email` LIKE '%smd.hu%';

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    User List:  [
      {
        id: '3c4debe2-e405-4cd7-8147-f27d6dee660a',
        username: 'Meki Lekk',
        email: 'pepe@smd.hu',
        points: 0,
        role: 'user',
        isActive: 'active',
        createdAt: '2025-08-28T21:27:32.000Z',
        updatedAt: '2025-08-28T21:27:32.000Z'
      },
      {
        id: '7046495d-4c2c-487c-a153-4ab4dd1c42de',
        username: 'Meki Admin',
        email: 'pepe2@smd.hu',
        points: 0,
        role: 'user',
        isActive: 'inactive',
        createdAt: '2025-08-28T21:27:32.000Z',
        updatedAt: '2025-09-02T07:55:22.000Z'
      }
    ]

      at Object.log (routes/usersRoutes_Ori.test.js:211:17)

  console.log
    Executing (default): SELECT `id`, `username`, `email`, `points`, `role`, `isActive`, `createdAt`, `updatedAt` FROM `users` AS `user` WHERE `user`.`username` LIKE '%Admin%' AND `user`.`email` LIKE '%smd.hu%';

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    User List:  [
      {
        id: '7046495d-4c2c-487c-a153-4ab4dd1c42de',
        username: 'Meki Admin',
        email: 'pepe2@smd.hu',
        points: 0,
        role: 'user',
        isActive: 'inactive',
        createdAt: '2025-08-28T21:27:32.000Z',
        updatedAt: '2025-09-02T07:55:22.000Z'
      }
    ]

      at Object.log (routes/usersRoutes_Ori.test.js:218:17)

  console.log
    Executing (default): SELECT `id`, `username`, `email`, `points`, `role`, `isActive`, `createdAt`, `updatedAt` FROM `users` AS `user` WHERE `user`.`username` LIKE '%Elek%';

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    User List:  [
      {
        id: '379f8a2e-c223-4e2b-8008-ec5144474007',
        username: 'Teszt Elek',
        email: 'tesztelget2000@gmail.com',
        points: 0,
        role: 'user',
        isActive: 'active',
        createdAt: '2025-08-22T19:37:48.000Z',
        updatedAt: '2025-08-22T19:37:48.000Z'
      },
      {
        id: 'ffcb5a6a-57d9-4518-bd49-7ac276df3f01',
        username: 'Mekk Elek',
        email: 'mindent_is_tudok@gmail.com',
        points: 0,
        role: 'user',
        isActive: 'inactive',
        createdAt: '2025-09-01T13:52:06.000Z',
        updatedAt: '2025-09-01T13:52:06.000Z'
      }
    ]

      at Object.log (routes/usersRoutes_Ori.test.js:225:17)

  console.log
    Executing (default): SELECT `id`, `username`, `email`, `points`, `role`, `isActive`, `createdAt`, `updatedAt` FROM `users` AS `user` WHERE `user`.`email` LIKE '%smd.hu%';

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    User List:  [
      {
        id: '3c4debe2-e405-4cd7-8147-f27d6dee660a',
        username: 'Meki Lekk',
        email: 'pepe@smd.hu',
        points: 0,
        role: 'user',
        isActive: 'active',
        createdAt: '2025-08-28T21:27:32.000Z',
        updatedAt: '2025-08-28T21:27:32.000Z'
      },
      {
        id: '7046495d-4c2c-487c-a153-4ab4dd1c42de',
        username: 'Meki Admin',
        email: 'pepe2@smd.hu',
        points: 0,
        role: 'user',
        isActive: 'inactive',
        createdAt: '2025-08-28T21:27:32.000Z',
        updatedAt: '2025-09-02T07:55:22.000Z'
      }
    ]

      at Object.log (routes/usersRoutes_Ori.test.js:232:17)

 PASS  routes/usersRoutes_Ori.test.js
  test for "Login" route
    √ Login as Admin    s11 [200] (225 ms)
    √ Admin Get User Data by Email [200] (27 ms)
    √ Admin modify User to Active [200] (19 ms)
    √ Login as User     s11 [200] (77 ms)
    √ Login as Worker   s11 [200] (75 ms)
  User Data of "users" route:
    √ GetUser Data with token_user FORBIDDEN [403] (13 ms)
    √ GetUser Data with token_admin [200] (23 ms)
    √ Admin mod. Selected User to another Role/Status [200] (26 ms)
    √ Worker mod. Selected User to another Role/Status - FORBIDDEN [403] (12 ms)
    √ User mod. Own Role/Status to another Role/Status - FORBIDDEN [403] (13 ms)
  GetList of "Institutions" route:
    √ Get Institutions List [200] (21 ms)
  User Data of "users" route 2:
    √ User modify own Institution Random - FORBIDDEN [403] (18 ms)
    √ Admin modify User Institution Random [200] (20 ms)
    √ Admin modify User Institution with Wrong User.ID [404] (14 ms)
    √ Admin modify User Institution with Wrong Inst.ID [400] (20 ms)
    √ Admin clear User Institution with NOT send Inst.ID (undefined) [400] (9 ms)
  User Data of "users" route 3:
    √ User mod. Own Data [200] (17 ms)
    √ Admin modify User to Inactive [200] (22 ms)
    √ Login as inActive User     s11 - Fodbidden [403] (71 ms)
    √ Login as inActive User     s11 - Fodbidden [403] (70 ms)
  User Data of "users" route 4:
    √ Admin Get Users Data by partial Email "smd.hu/Mek" [200] (16 ms)
    √ Admin Get Users Data by partial Email "smd.hu/" [200] (15 ms)
    √ Admin Get Users Data by partial Email "smd.hu/Admin" [200] (15 ms)
    √ Admin Get Users Data by partial Email "/Elek" [200] (16 ms)
    √ Admin Get Users Data by partial Email "smd.hu/" [200] (17 ms)

Test Suites: 1 passed, 1 total
Tests:       25 passed, 25 total
Snapshots:   0 total
Time:        2.062 s
Ran all test suites.

d:\- - - - - x.Egressy 2023\- 3. Félév\- - - Tiszta Város\TisztaVaros_BackEnd__Github\backend\routes>